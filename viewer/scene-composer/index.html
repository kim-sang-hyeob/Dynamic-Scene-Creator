<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4DGS Scene Composer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="css/composer.css">
</head>

<body>
  <canvas id="canvas"></canvas>

  <!-- Progress bar -->
  <div id="progress" style="width: 0%"></div>

  <!-- Top HUD -->
  <div id="top-bar">
    <span id="fps" class="stat-tag">0 fps</span>
    <span id="gaussian-count" class="stat-tag">0 gaussians</span>
    <span id="layer-count" class="stat-tag">0 layers</span>
    <div id="gizmo-modes" class="gizmo-modes" style="display:none;">
      <button class="gizmo-mode-btn active" data-mode="translate" title="G: Translate">T</button>
      <button class="gizmo-mode-btn" data-mode="rotate" title="R: Rotate">R</button>
      <button class="gizmo-mode-btn" data-mode="scale" title="S: Scale">S</button>
    </div>
  </div>

  <!-- Loading spinner -->
  <div id="spinner" style="display: none;">
    <div class="spinner-ring"></div>
    <span style="font-size: 13px; color: var(--text-secondary);">Loading...</span>
  </div>

  <!-- Drag-and-drop zone / Empty State -->
  <div id="drop-zone" class="empty">
    <div class="drop-icon">+</div>
    <div class="drop-label">Scene Composer</div>
    <div class="drop-sublabel">3D ì”¬ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</div>
    <div class="empty-actions">
      <div class="empty-action"><span class="empty-action-icon">ğŸ“</span><span>.splat íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ Map ì¶”ê°€</span></div>
      <div class="empty-action"><span class="empty-action-icon">âœ¨</span><span>í•˜ë‹¨ í”„ë¡¬í”„íŠ¸ ë°”ì—ì„œ ì´ë¯¸ì§€ë¡œ 3D ì˜¤ë¸Œì íŠ¸ ìƒì„±</span></div>
    </div>
    <div class="empty-hint">Ctrl+Vë¡œ í´ë¦½ë³´ë“œ ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥</div>
  </div>

  <!-- Right Sidebar (tabbed: Layers / Path) -->
  <div id="sidebar-panel" class="glass">
    <!-- Tab Headers -->
    <div class="sidebar-tabs">
      <button class="sidebar-tab active" data-tab="layers">Layers</button>
      <button class="sidebar-tab" data-tab="path">Path</button>
    </div>

    <!-- Tab 1: Layers -->
    <div id="tab-layers" class="sidebar-tab-content active">
      <div id="layer-list"></div>

      <!-- Transform inputs for selected layer -->
      <div id="transform-section" class="transform-section hidden">
        <div class="transform-title">Position</div>
        <div class="transform-row">
          <span class="transform-label x">X</span>
          <input id="pos-x" class="transform-input" type="number" step="0.1" value="0">
          <span class="transform-label y">Y</span>
          <input id="pos-y" class="transform-input" type="number" step="0.1" value="0">
          <span class="transform-label z">Z</span>
          <input id="pos-z" class="transform-input" type="number" step="0.1" value="0">
        </div>

        <div class="transform-title">Rotation</div>
        <div class="transform-row">
          <span class="transform-label x">X</span>
          <input id="rot-x" class="transform-input" type="number" step="5" value="0">
          <span class="transform-label y">Y</span>
          <input id="rot-y" class="transform-input" type="number" step="5" value="0">
          <span class="transform-label z">Z</span>
          <input id="rot-z" class="transform-input" type="number" step="5" value="0">
        </div>

        <div class="transform-title">Scale</div>
        <div class="transform-row">
          <span class="transform-label" style="color:var(--text-muted)">S</span>
          <input id="scale" class="transform-input" type="number" step="0.1" min="0.01" max="100" value="1.00">
        </div>
      </div>

      <div class="panel-footer">
        <button class="add-layer-btn">+ Add Layer</button>
        <button class="export-scene-btn" title="Export merged scene as .splatv">&#128190; Export Scene</button>
      </div>
    </div>

    <!-- Tab 2: Path (filled by PathEditorPanel) -->
    <div id="tab-path" class="sidebar-tab-content">
      <div class="scroll-area" id="path-scroll-area">
        <!-- Mode buttons (2x2 grid) -->
        <div class="pe-section-title">INTERACTION MODE</div>
        <div id="pe-mode-buttons" class="pe-mode-grid">
          <button class="pe-mode-btn active" data-mode="view">1 View</button>
          <button class="pe-mode-btn" data-mode="place">2 Place</button>
          <button class="pe-mode-btn" data-mode="select">3 Select</button>
          <button class="pe-mode-btn" data-mode="animate">4 Animate</button>
        </div>

        <!-- Control Points -->
        <div class="pe-section-title">CONTROL POINTS</div>
        <div id="pe-point-list" class="pe-point-list"></div>

        <!-- Path Duration -->
        <div class="pe-control-group">
          <div class="pe-slider-row">
            <div class="pe-slider-header">
              <span class="pe-slider-label">Path Duration</span>
              <span class="pe-slider-val" id="pe-duration-val">5.0s</span>
            </div>
            <input type="range" id="pe-duration-slider" min="1" max="30" step="0.5" value="5">
          </div>
        </div>

        <!-- Dome Camera -->
        <div class="pe-section-title">DOME CAMERA</div>
        <div class="pe-control-group">
          <div class="pe-slider-row">
            <div class="pe-slider-header">
              <span class="pe-slider-label">Dome Radius</span>
              <span class="pe-slider-val" id="pe-cam-dist-val">3.0</span>
            </div>
            <input type="range" id="pe-cam-dist-slider" min="0.5" max="15" step="0.1" value="3.0">
          </div>
          <div class="pe-slider-row">
            <div class="pe-slider-header">
              <span class="pe-slider-label">Azimuth Angle</span>
              <span class="pe-slider-val" id="pe-cam-az-val">0&deg;</span>
            </div>
            <input type="range" id="pe-cam-az-slider" min="0" max="360" step="5" value="0">
          </div>
          <div class="pe-slider-row">
            <div class="pe-slider-header">
              <span class="pe-slider-label">Elevation Angle</span>
              <span class="pe-slider-val" id="pe-cam-el-val">15&deg;</span>
            </div>
            <input type="range" id="pe-cam-el-slider" min="-30" max="85" step="5" value="15">
          </div>
          <label class="pe-checkbox">
            <input type="checkbox" id="pe-show-cams" checked>
            Show Frustum Viz
          </label>
        </div>

        <!-- Export Settings -->
        <div class="pe-section-title">EXPORT SETTINGS</div>
        <div class="pe-control-group">
          <div class="pe-slider-row">
            <div class="pe-slider-header">
              <span class="pe-slider-label">Target FPS</span>
              <span class="pe-slider-val" id="pe-export-fps-val">30</span>
            </div>
            <input type="range" id="pe-export-fps-slider" min="1" max="60" step="1" value="30">
          </div>
          <div id="pe-frame-info" class="pe-frame-info">Frames: --</div>
          <button class="pe-export-btn" id="pe-export-btn">Export Training Dataset</button>
        </div>

        <!-- Shortcuts -->
        <div class="pe-section-title">SHORTCUTS</div>
        <div class="pe-shortcuts">
          1-4: Switch Modes &bull; Del: Remove Point<br>
          Space: Play/Stop &bull; Ctrl/Cmd+Z: Undo<br>
          WASD: Move Camera
        </div>
      </div>

      <!-- Bottom Action Bar (inside path tab) -->
      <div id="pe-action-bar" class="pe-action-bar">
        <button class="pe-icon-btn" id="pe-btn-save" title="Save Path JSON">&#128190;</button>
        <button class="pe-icon-btn" id="pe-btn-load" title="Load Path JSON">&#128194;</button>
        <div class="pe-bar-divider"></div>
        <button class="pe-icon-btn pe-primary pe-play-btn" id="pe-btn-play" title="Play Animation">&#9654;</button>
        <button class="pe-icon-btn pe-danger-btn" id="pe-btn-record" title="Record WebM">&#9679;</button>
        <div class="pe-bar-divider"></div>
        <button class="pe-icon-btn pe-danger-btn" id="pe-btn-clear" title="Clear All">&#128465;</button>
      </div>
    </div>
  </div>

  <!-- World Labs Modal -->
  <div id="worldlabs-modal" class="wl-modal" style="display:none;"></div>

  <!-- Prompt Bar (bottom center) -->
  <div id="prompt-bar" class="glass"></div>

  <!-- Message -->
  <div id="message"></div>

  <!-- Hint bubble (auto-hides after 5s) -->
  <div id="hint-bubble" class="hint-bubble">Press <kbd>?</kbd> for shortcuts</div>

  <!-- Help Overlay (toggled by ? key) -->
  <div id="help-overlay" class="help-overlay" style="display:none;">
    <div class="help-card glass">
      <div class="help-header">
        <h3>Keyboard Shortcuts</h3>
        <button class="help-close" id="help-close-btn">&times;</button>
      </div>
      <div class="help-grid">
        <div class="help-section">
          <h4>ì˜¤ë¸Œì íŠ¸ ì¡°ì‘</h4>
          <div class="help-row"><kbd>ë“œë˜ê·¸</kbd><span>ë°”ë‹¥ ìœ„ ì´ë™</span></div>
          <div class="help-row"><kbd>Alt+ë“œë˜ê·¸</kbd><span>ë†’ì´ ì¡°ì ˆ</span></div>
          <div class="help-row"><kbd>ìš°í´ë¦­+ë“œë˜ê·¸</kbd><span>íšŒì „</span></div>
          <div class="help-row"><kbd>ìŠ¤í¬ë¡¤</kbd><span>í¬ê¸° ì¡°ì ˆ</span></div>
          <div class="help-row"><kbd>Shift</kbd><span>ìŠ¤ëƒ… ì´ë™</span></div>
          <div class="help-row"><kbd>Arrow</kbd><span>ë¯¸ì„¸ ì´ë™</span></div>
          <div class="help-row"><kbd>Delete</kbd><span>ì‚­ì œ</span></div>
        </div>
        <div class="help-section">
          <h4>ì¹´ë©”ë¼</h4>
          <div class="help-row"><kbd>ë¹ˆ ê³³ ë“œë˜ê·¸</kbd><span>íšŒì „</span></div>
          <div class="help-row"><kbd>ìš°í´ë¦­ ë¹ˆ ê³³</kbd><span>ì´ë™</span></div>
          <div class="help-row"><kbd>ìŠ¤í¬ë¡¤ ë¹ˆ ê³³</kbd><span>ì¤Œ</span></div>
          <div class="help-row"><kbd>W A S D</kbd><span>ì¹´ë©”ë¼ ì´ë™</span></div>
          <div class="help-row"><kbd>Q / E</kbd><span>ìƒí•˜ ì´ë™</span></div>
        </div>
        <div class="help-section">
          <h4>ê¸°ì¦ˆëª¨ (ì •ë°€)</h4>
          <div class="help-row"><kbd>G</kbd><span>ì´ë™ ê¸°ì¦ˆëª¨</span></div>
          <div class="help-row"><kbd>R</kbd><span>íšŒì „ ê¸°ì¦ˆëª¨</span></div>
          <div class="help-row"><kbd>Esc</kbd><span>ì„ íƒ í•´ì œ</span></div>
        </div>
        <div class="help-section">
          <h4>ì¼ë°˜</h4>
          <div class="help-row"><kbd>Ctrl+Z</kbd><span>ë˜ëŒë¦¬ê¸°</span></div>
          <div class="help-row"><kbd>Ctrl+Y</kbd><span>ë‹¤ì‹œ</span></div>
          <div class="help-row"><kbd>Ctrl+V</kbd><span>ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸°</span></div>
          <div class="help-row"><kbd>?</kbd><span>ì´ ë„ì›€ë§</span></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="js/main.js"></script>
</body>

</html>
